FROM python:3.12

RUN apt-get update && apt-get install -y \
    gcc \
    g++ \
    make \
    cmake \
    icu-devtools \
    libicu-dev \
    libicu67 \
    zlib1g-dev \
    libssl-dev

RUN git clone --recurse-submodules https://github.com/couchbase/couchbase-lite-C.git

WORKDIR /src/couchbase-lite-C

# Set environment variables
ENV VERSION="3.1.3"

RUN mkdir build && \
    cd build && \
    cmake -DCMAKE_BUILD_TYPE=MinSizeRel -DCMAKE_INSTALL_PREFIX=`pwd`/output .. && \
    make
